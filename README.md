# Проект: Интеграция MSSQL с Odoo через RabbitMQ

## Описание

Этот проект представляет собой прототип системы интеграции между базой данных MSSQL и ERP-системой Odoo, используя брокер сообщений RabbitMQ для передачи данных. Он предназначен для синхронизации данных о продуктах из MSSQL в Odoo в режиме реального времени.

## Состав проекта

- **MSSQL**: Хранит данные о продуктах и штрихкодах. Использует Change Data Capture (CDC) для отслеживания изменений.
- **RabbitMQ**: Брокер сообщений, через который передаются данные о изменениях.
- **Odoo**: ERP-система, куда импортируются данные о продуктах.
- **Data Extractor**: Сервис, который отслеживает изменения в MSSQL и отправляет их в RabbitMQ.
- **Data Processor**: Сервис, который получает сообщения из RabbitMQ и обновляет данные в Odoo.
- **Docker Compose**: Используется для управления всеми сервисами в контейнерах.

## Установка и запуск

### Предварительные требования

- Docker и Docker Compose установлены на вашей машине.
- Только amd64 архитектура процессора

### Инструкция по запуску

1. **Клонируйте репозиторий:**

   ```bash
   git clone https://github.com/yourusername/yourproject.git
   cd yourproject
   ```

2. **Запустите Docker Compose:**

   ```bash
   docker-compose up -d
   ```

3. **Проверьте, что все контейнеры запущены:**

   ```bash
   docker-compose ps
   ```

4. **Откройте Odoo в браузере:**

    - Перейдите по адресу [http://localhost:8069](http://localhost:8069) и войдите в систему, используя логин `admin` и пароль `admin`.

    - Создайте базу данных

    - Установите необходимые модули. Для работы с продуктами достаточно установить один из модулей: Продажи, Закупки, Склад, Производство

5. **Тестирование работы синхронизации:**

   - **Добавьте новый продукт в MSSQL:**

     - Подключитесь к контейнеру MSSQL:

       ```bash
       docker exec -it mssql /opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P 'Admin@123'
       ```

     - Переключитесь на базу данных `TestDB`:

       ```sql
       USE TestDB;
       GO
       ```

     - Вставьте новый продукт:

       ```sql
       INSERT INTO dbo.Products (ProductName) VALUES ('Тестовый продукт');
       GO
       ```

     - Получите `ProductID` добавленного продукта:

       ```sql
       SELECT @@IDENTITY AS 'ProductID';
       GO
       ```

     - Добавьте штрихкод для продукта (замените `<ProductID>` на фактический идентификатор):

       ```sql
       INSERT INTO logistics.ProductBarcodes (ProductID, Barcode) VALUES (<ProductID>, '1234567890123');
       GO
       ```

     - Выйдите из `sqlcmd`:

       ```sql
       QUIT
       ```

   - **Проверьте появление продукта в Odoo:**

     - В Odoo перейдите в меню **Продажи** или **Склад** и выберите **Продукты**.
     - Найдите продукт с названием `Тестовый продукт`.
     - Убедитесь, что штрихкод соответствует добавленному.

   - **Просмотрите логи сервисов для проверки передачи данных:**

     - **Data Extractor:**

       ```bash
       docker-compose logs -f data_extractor
       ```

     - **Data Processor:**

       ```bash
       docker-compose logs -f data_processor
       ```

     - Убедитесь, что нет ошибок и сообщения обрабатываются корректно.

## Структура проекта

- `docker-compose.yml`: Конфигурация Docker Compose.
- `mssql/`: Файлы для MSSQL, включая `init.sql` для инициализации базы данных.
- `data_extractor/`: Код сервиса Data Extractor.
- `data_processor/`: Код сервиса Data Processor.
- `odoo/`: Конфигурация для Odoo.
- `rabbitmq.conf`: Конфигурационный файл для RabbitMQ.

## Настройка

### Переменные окружения

В файле `docker-compose.yml` вы можете изменить переменные окружения для настройки паролей и других параметров.

### Файлы конфигурации

- **MSSQL**: Скрипт `init.sql` инициализирует базу данных и включает CDC.
- **Odoo**: Файл `odoo.conf` содержит настройки подключения к базе данных PostgreSQL.
- **RabbitMQ**: Файл `rabbitmq.conf` настраивает параметры RabbitMQ.
